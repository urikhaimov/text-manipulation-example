<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />

    <title>Text manipulation exercise</title>
    <script>

        const replaceSelectedText = (replacementText) => {
            let sel, range;
            if (window.getSelection) {
                sel = window.getSelection();
                if (sel.rangeCount) {
                    range = sel.getRangeAt(0);
                    range.deleteContents();
                    range.insertNode(document.createTextNode(replacementText));
                }
            } else if (document.selection && document.selection.createRange) {
                range = document.selection.createRange();
                range.text = replacementText;
            }
        }

        const getSelectedText = () => {
            if (window.getSelection) {
                return window.getSelection();
            } else if (document.selection) {
                return document.selection.createRange();
            }
            return null;
        }

        const transformSelectedToBold = () => {
            const selected = getSelectedText()
            let span = document.createElement('SPAN');
            span.classList.add('bold');
            span.textContent = selected.toString();
            let range = selected.getRangeAt(0);
            range.deleteContents();
            range.insertNode(span);
        }

        const replaceFirst = (data) => {
            let arr = [...data]
            let first = arr[0]
            arr.shift()
            arr.push(first)
            return arr
        }

        Array.prototype.swap = function (x, y) {
            let b = this[x];
            this[x] = this[y];
            this[y] = b;
            return this;
        }
        const replaceLast = (data) => {
            let arr = [...data]
            let last = arr[arr.length - 1]
            arr.unshift(last)
            arr.pop()
            return arr
        }
        const isEmptyOrSpaces = (str) => str === null || str.match(/^ *$/) !== null;


        const convertSelectedToArray = (text, selectedText, start, end) => {
            let selectedArr = [...selectedText.split(' ')]
            let result = selectedArr
            console.log('end length = ', text[end - 1].length)
            const isEndNotValid = (text[end] !== ' ' && text[end - 1] !== ' ' && end < text.length)
                || !text[end - 1] || isEmptyOrSpaces( text[end - 1]);
            const isStartNotValid = (text[start] !== ' ' && text[start - 1] !== ' ' && start > 0)
                || !text[start] || isEmptyOrSpaces(text[start]);
            if (isEndNotValid && !isStartNotValid) {
                console.log('endNot valid', selectedArr)
                result = replaceLast(selectedArr);
            }
            if (isStartNotValid && !isEndNotValid) {
                console.log('startNot valid', selectedArr)
                result = replaceFirst(selectedArr);
            }

            if (isEndNotValid && isStartNotValid) {
                result = selectedArr.swap(0, selectedArr.length - 1)
            }

            return result.reverse();
        }

        const reverseSelected = (text) => {
            const selection = getSelectedText();
            let selectedText = selection.toString();
            const start = selection.anchorOffset;
            const end = selection.focusOffset;
            replaceSelectedText(convertSelectedToArray(text, selectedText, start, end).join(' '));
        }

        window.onload = () => {
            const text = document.getElementById('text');
            const bold = document.getElementById('bold')
            const reverse = document.getElementById('reverse')

            text.addEventListener('mouseup', e => {

                const selection = getSelectedText();
                const tooltip = document.getElementById('tooltip')
                tooltip.style.visibility = 'visible';
                selection.toString() !== '' &&
                    console.log('"' + selection + '" was selected at ' + e.pageX + '/' + e.pageY);



            });
            bold.addEventListener('click', transformSelectedToBold, false)
            reverse.addEventListener('click', reverseSelected.bind(this, text.innerText), false)

        }



    </script>
    <style>
        /* Tooltip container */
        #tooltip {
            visibility: hidden;
            width: 120px;
            padding: 5px 0;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
        }

        .bold {
            font-weight: bold;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        /* .tooltip:hover .tooltiptext {
  visibility: visible;
} */
    </style>
</head>

<body>
    <div id="root">

        <div contenteditable="true" id="text">fooobar fo foo lastttt fooooo


        </div>
        <div id="tooltip">
            <button id="bold">B</button>
            <button id="reverse">R</button>
        </div><br><br>

    </div>

</body>

</html>