<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />

    <title>Text manipulation exercise</title>
    <script>

        const replaceSelectedText = (replacementText) => {
            var sel, range;
            if (window.getSelection) {
                sel = window.getSelection();
                if (sel.rangeCount) {
                    range = sel.getRangeAt(0);
                    range.deleteContents();
                    range.insertNode(document.createTextNode(replacementText));
                }
            } else if (document.selection && document.selection.createRange) {
                range = document.selection.createRange();
                range.text = replacementText;
            }
        }

        const getSelectedText = () => {
            if (window.getSelection) {
                return window.getSelection();
            } else if (document.selection) {
                return document.selection.createRange();
            }
            return null;
        }

        const transformSelectedToBold = () => {
            const selected = getSelectedText()
            let span = document.createElement('SPAN');
            span.classList.add('bold');
            span.textContent = selected.toString();
            var range = selected.getRangeAt(0);
            range.deleteContents();
            range.insertNode(span);
        }

        const convertSelectedToArray = (text) => {
            const r = [...text.trim().split(' ')]
            console.log('r', r)
            return r
        }

        const reverseSelected = (text) => {
            const selection = getSelectedText();
            let selectedText = selection.toString();
            const start = selection.anchorOffset;
            const end = selection.focusOffset;
            console.log('start', start, 'end', end)
            let updatedText = convertSelectedToArray(selectedText).reverse().join(' ')
            console.log('text[0]', text[0])
            console.log('text[start]', text[start], 'text[start - 1]', text[start - 1])
            if (text[start - 1] !== ' ') {
                updatedText = ' ' + updatedText
            }
            if (text[end] !== ' ') {
                updatedText += ' '
            }
            if (text[start] !== ' ' && text[start - 1] !== ' ') {
                console.log('start')
                updatedText = convertSelectedToArray(selectedText).slice(0, 1).reverse().join(' ')
            }
            console.log('text[end]', text[end], 'text[end - 1]', text[end - 1])
            if (text[end] !== ' ' && text[end - 1] !== ' ') {
                console.log('end')
                updatedText = convertSelectedToArray(selectedText).slice(0, -1).reverse().join(' ')
            }
            replaceSelectedText(updatedText);
        }

        window.onload = () => {
            const text = document.getElementById('text');
            const bold = document.getElementById('bold')
            const reverse = document.getElementById('reverse')

            text.addEventListener('mouseup', e => {

                const selection = getSelectedText();
                const tooltip = document.getElementById('tooltip')
                tooltip.style.visibility = 'visible';
                selection.toString() !== '' &&
                    console.log('"' + selection + '" was selected at ' + e.pageX + '/' + e.pageY);



            });
            bold.addEventListener('click', transformSelectedToBold, false)
            reverse.addEventListener('click', reverseSelected.bind(this, text.innerText), false)

        }



    </script>
    <style>
        /* Tooltip container */
        #tooltip {
            visibility: hidden;
            width: 120px;
            padding: 5px 0;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
        }

        .bold {
            font-weight: bold;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        /* .tooltip:hover .tooltiptext {
  visibility: visible;
} */
    </style>
</head>

<body>
    <div id="root">

        <div contenteditable="true" id="text">fooobar fo foo foo fooooo


        </div>
        <div id="tooltip">
            <button id="bold">B</button>
            <button id="reverse">R</button>
        </div><br><br>

    </div>

</body>

</html>