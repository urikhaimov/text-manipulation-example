<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />

    <title>Text manipulation exercise</title>
    <script>


        window.addEventListener('mouseup', e => {
            const text = e.target.innerText;
            let start = 0;
            let end = 0;
            let updatedText = '';
            if (window.getSelection) {
                selection = window.getSelection();
                start = selection.anchorOffset;
                end = selection.focusOffset;
            } else if (document.selection) {
                selection = document.selection.createRange();
                start = selection.anchorOffset;
                end = selection.focusOffset;
            }

            selection.toString() !== '' && console.log('"' + selection.toString() + '" was selected at ' + e.pageX + '/' + e.pageY);
            const selectedText = selection.toString();
            console.log('start', start, text[start])
            console.log('end', end)
            updatedText = [...selectedText.split('')].reverse().join('')
            if(text[start] !== ' ' && text[start-1] !== ' ') {
                updatedText = [...selectedText.split('')].slice(0,1).reverse().join('')
        
            }
            if(text[end] !== ' ' && text[end-1] !== ' ') {
                updatedText = [...selectedText.split('')].slice(0,-1).reverse().join('')
            }
           replaceSelectedText(updatedText);

        });


        function replaceSelectedText(replacementText) {
            var sel, range;
            if (window.getSelection) {
                console.log('window')
                sel = window.getSelection();
                if (sel.rangeCount) {
                    range = sel.getRangeAt(0);
                    range.deleteContents();
                    range.insertNode(document.createTextNode(replacementText));
                }
            } else if (document.selection && document.selection.createRange) {
                console.log('document')
                range = document.selection.createRange();
                range.text = replacementText;
            }
        }
        function handler(e) {
            console.log(e.target)
        }
    </script>

</head>

<body>
    <div id="root">

        <div contenteditable="true">fooobar fo foo foo fooooo</div>
    </div>

</body>

</html>